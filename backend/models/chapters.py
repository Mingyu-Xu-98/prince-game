"""
å…³å¡ç³»ç»Ÿæ¨¡åž‹
å®šä¹‰5ä¸ªå…³å¡çš„åœºæ™¯ã€å›°å¢ƒå’Œåšå¼ˆæœºåˆ¶
"""
from pydantic import BaseModel, Field
from typing import Optional
from enum import Enum


class ChapterID(str, Enum):
    """å…³å¡ID"""
    CHAPTER_1 = "chapter_1"  # ç©ºé¥·å±æœº
    CHAPTER_2 = "chapter_2"  # ç˜Ÿç–«ä¸Žæµè¨€
    CHAPTER_3 = "chapter_3"  # å’Œäº²è¿˜æ˜¯æˆ˜äº‰
    CHAPTER_4 = "chapter_4"  # å½±å­è®®ä¼šçš„èƒŒå›
    CHAPTER_5 = "chapter_5"  # æ°‘ä¼—çš„å®¡åˆ¤


class ChapterStatus(str, Enum):
    """å…³å¡çŠ¶æ€"""
    LOCKED = "locked"
    ACTIVE = "active"
    COMPLETED = "completed"
    FAILED = "failed"


class AdvisorSuggestion(BaseModel):
    """é¡¾é—®å»ºè®®"""
    advisor: str  # lion / fox / balance
    suggestion: str
    reasoning: str
    predicted_impact: dict = Field(default_factory=dict)


class Chapter(BaseModel):
    """å…³å¡å®šä¹‰"""
    id: ChapterID
    name: str
    subtitle: str
    complexity: int = Field(ge=1, le=5, description="å¤æ‚åº¦ 1-5æ˜Ÿ")

    # åœºæ™¯æè¿°
    background: str
    scene_snapshot: str
    dilemma: str

    # æ ¸å¿ƒåšå¼ˆ
    core_conflict: str
    teaching_objective: str

    # é¡¾é—®å»ºè®®
    lion_suggestion: AdvisorSuggestion
    fox_suggestion: AdvisorSuggestion
    balance_suggestion: Optional[AdvisorSuggestion] = None

    # ç‰¹æ®Šæœºåˆ¶
    special_mechanics: list[str] = Field(default_factory=list)

    # èƒœåˆ©/å¤±è´¥æ¡ä»¶
    victory_conditions: list[str] = Field(default_factory=list)
    failure_conditions: list[str] = Field(default_factory=list)

    # åˆå§‹æ•°å€¼è°ƒæ•´
    initial_modifiers: dict = Field(default_factory=dict)

    # å›žåˆé™åˆ¶
    max_turns: int = 5

    # æ˜¯å¦éšè—æ•°å€¼ï¼ˆé»‘ç®±å®¡è®¡ï¼‰
    hide_values: bool = False


class ChapterProgress(BaseModel):
    """å…³å¡è¿›åº¦"""
    chapter_id: ChapterID
    status: ChapterStatus = ChapterStatus.LOCKED
    current_turn: int = 0
    decisions_made: list[dict] = Field(default_factory=list)
    promises_made: list[dict] = Field(default_factory=list)  # æ‰¿è¯ºè¿½è¸ª
    secrets_kept: list[dict] = Field(default_factory=list)  # ç§˜å¯†/è°Žè¨€
    betrayals_detected: int = 0

    # å…³å¡ç‰¹æ®ŠçŠ¶æ€
    fox_has_leverage: bool = False  # ç‹ç‹¸æ˜¯å¦æŠ“ä½æŠŠæŸ„
    lion_trust_broken: bool = False  # ç‹®å­ä¿¡ä»»æ˜¯å¦ç ´è£‚
    information_leaked: bool = False  # ä¿¡æ¯æ˜¯å¦æ³„éœ²

    # è¯„ä»·
    final_score: Optional[int] = None
    ending_type: Optional[str] = None


class ChapterLibrary:
    """å…³å¡åº“"""

    @staticmethod
    def get_all_chapters() -> dict[ChapterID, Chapter]:
        return {
            ChapterID.CHAPTER_1: Chapter(
                id=ChapterID.CHAPTER_1,
                name="ç©ºé¥·å±æœº",
                subtitle="æƒåŠ›çš„å…¥åœºåˆ¸",
                complexity=1,
                background="""ä½ åˆšåˆšç»§ä½ç¬¬äºŒå¤©ã€‚

å‰ä»»å›ä¸»ç•™ä¸‹äº†ä¸€ä¸ªçƒ‚æ‘Šå­â€”â€”å†›é¥·è¢«è´ªæ±¡äº†æ•´æ•´ä¸‰ä¸ªæœˆã€‚
ä»Šæ™¨ï¼Œæ„¤æ€’çš„å£«å…µä»¬å·²ç»å›´å µåœ¨è®®äº‹åŽ…å¤–ï¼Œä»–ä»¬çš„å‘å–Šå£°éœ‡å¾—çª—æ£‚å‘é¢¤ã€‚

å›½åº“åªå‰©ä¸‹åº”ä»˜å†›é¥·çš„ä¸€åŠã€‚
è€Œå£«å…µä»¬çš„è€å¿ƒï¼Œæ˜¾ç„¶ä¹Ÿåªå‰©ä¸€åŠäº†ã€‚""",

                scene_snapshot="""ã€åœºæ™¯å¿«ç…§ã€‘

åœ°ç‚¹ï¼šçŽ‹å®«è®®äº‹åŽ…
æ—¶é—´ï¼šç»§ä½ç¬¬äºŒæ—¥ï¼Œè¾°æ—¶

çª—å¤–ä¼ æ¥å£«å…µä»¬æ„¤æ€’çš„å‘å–Šï¼Œé“ç”²ç¢°æ’žå£°æ­¤èµ·å½¼ä¼ã€‚
ä¸‰ä½é¡¾é—®å·²åœ¨åŽ…ä¸­ç­‰å€™â€”â€”

ðŸ”´ ç‹®å­å°†å†›ç«™åœ¨çª—è¾¹ï¼Œæ‰‹æŒ‰å‰‘æŸ„ï¼Œé¢è‰²é“é’ã€‚
ðŸŸ£ ç‹ç‹¸é¦–ç›¸ååœ¨é˜´å½±ä¸­ï¼Œæ‰‹æŒ‡è½»å©æ¡Œé¢ï¼Œè‹¥æœ‰æ‰€æ€ã€‚
âš–ï¸ å¤©å¹³å¤§æ³•å®˜æ‰‹æŒè´¦ç°¿ï¼Œçœ‰å¤´ç´§é”ã€‚

è´¦ç°¿ä¸Šçš„æ•°å­—è§¦ç›®æƒŠå¿ƒï¼š
  â€¢ æ¬ é¥·æ€»é¢ï¼š50,000é‡‘å¸
  â€¢ å›½åº“ä½™é¢ï¼š27,000é‡‘å¸
  â€¢ ç¼ºå£ï¼š23,000é‡‘å¸

å£«å…µä»£è¡¨å·²åœ¨é—¨å¤–ç­‰å€™è§è§ã€‚""",

                dilemma="åº“æˆ¿åªæœ‰ä¸€åŠçš„é’±ã€‚ä½ å¿…é¡»åœ¨ä»Šå¤©ç»™å‡ºç­”å¤ï¼Œå¦åˆ™å…µå˜ä¸€è§¦å³å‘ã€‚",

                core_conflict="ç®€å•çš„èµ„æºåˆ†é…ä¸Žä¿¡ç”¨å¯¹é½",
                teaching_objective="è®©çŽ©å®¶ç†è§£'æ‰¿è¯º'æ˜¯æœ‰ä»£ä»·çš„ã€‚å¦‚æžœå¬ä»Žç‹ç‹¸å´æ²¡åœ¨ä¸‹å›žåˆè¡¥ä¸Šé’±ï¼Œå°†ç«‹å³ä¿¡ç”¨ç ´äº§ã€‚",

                lion_suggestion=AdvisorSuggestion(
                    advisor="lion",
                    suggestion="å¤„å†³å¸¦å¤´é—¹äº‹çš„å£«å…µï¼Œæ€ä¸€å„†ç™¾ã€‚",
                    reasoning="ä¹±å†›ä¹‹ä¸­ï¼Œå¿…æœ‰é¦–æ¶ã€‚æ–©å…¶é¦–åˆ™ç¾¤é¾™æ— é¦–ï¼Œä½™ä¼—è‡ªæ•£ã€‚å±•çŽ°é“è…•ï¼Œæ‰èƒ½ç¨³å›ºå†›å¿ƒã€‚",
                    predicted_impact={"fear": 15, "love": -10, "authority": 5}
                ),

                fox_suggestion=AdvisorSuggestion(
                    advisor="fox",
                    suggestion="å…ˆå‘ä¸€åŠçŽ°é“¶å®‰æŠšï¼Œå…¶ä½™ä»¥æœŸç¥¨å½¢å¼æ‰¿è¯ºä¸‰æ—¥å†…è¡¥é½ã€‚å¯¹å¤–å®£ç§°è¿é“¶é˜Ÿä¼å·²åœ¨è·¯ä¸Šã€‚",
                    reasoning="å£«å…µè¦çš„æ˜¯é’±ï¼Œä¸æ˜¯å‘½ã€‚ç»™ä»–ä»¬å¸Œæœ›ï¼Œå°±èƒ½äº‰å–æ—¶é—´ã€‚è‡³äºŽä¸‰æ—¥åŽ...é™›ä¸‹è‡ªæœ‰åŠžæ³•ã€‚",
                    predicted_impact={"fear": -5, "love": 5, "authority": 0}
                ),

                balance_suggestion=AdvisorSuggestion(
                    advisor="balance",
                    suggestion="å…¬å¼€å®¡åˆ¤è´ªè…å®˜å‘˜ï¼Œè¿½ç¼´èµƒæ¬¾ï¼Œç”¨å®žé™…è¡ŒåŠ¨è¯æ˜Žæ–°å›ä¸Žæ—§åˆ¶ä¸åŒã€‚",
                    reasoning="å£«å…µçš„æ„¤æ€’æºäºŽä¸å…¬ã€‚æƒ©æ²»è´ªå®˜ï¼Œæ—¢èƒ½è¿½å›žéƒ¨åˆ†æ¬ æ¬¾ï¼Œåˆèƒ½èµ¢å¾—å†›å¿ƒã€‚",
                    predicted_impact={"fear": 0, "love": 10, "authority": 5}
                ),

                special_mechanics=[
                    "æ‰¿è¯ºè¿½è¸ªï¼šå¦‚æžœæ‰¿è¯ºæœŸç¥¨ï¼Œå¿…é¡»åœ¨3å›žåˆå†…å…‘çŽ°",
                    "ä¿¡ç”¨ç³»ç»Ÿï¼šè¿èƒŒæ‰¿è¯ºä¼šè¢«ç‹ç‹¸è®°å½•ä¸º'æŠŠæŸ„'"
                ],

                victory_conditions=[
                    "è§£å†³å†›é¥·é—®é¢˜ä¸”ä¸å¼•å‘å…µå˜",
                    "ä¿æŒ Authority > 30%"
                ],
                failure_conditions=[
                    "Authority å½’é›¶ï¼ˆè¢«ç¯¡ä½ï¼‰",
                    "Love å½’é›¶ï¼ˆæš´ä¹±ï¼‰",
                    "3å›žåˆå†…æœªè§£å†³é—®é¢˜"
                ],

                initial_modifiers={"authority": 50, "fear": 40, "love": 45},
                max_turns=5
            ),

            ChapterID.CHAPTER_2: Chapter(
                id=ChapterID.CHAPTER_2,
                name="ç˜Ÿç–«ä¸Žæµè¨€",
                subtitle="æƒ…æ„Ÿä¸Žç†æ™ºçš„æ’•è£‚",
                complexity=2,
                background="""ç¬¬ä¸€åœºå±æœºåˆšåˆšå¹³æ¯ï¼Œæ–°çš„å™©è€—ä¼ æ¥ã€‚

è´«æ°‘åŒºçˆ†å‘äº†ä¸æ˜Žç˜Ÿç–«ï¼Œå·²æœ‰æ•°ç™¾äººç—…å€’ã€‚
æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæµè¨€æ­£åœ¨åŸŽä¸­è”“å»¶â€”â€”æœ‰äººè¯´è¿™æ˜¯ä¸Šå¤©å¯¹æ–°å›çš„æƒ©ç½šã€‚

å¯ŒäººåŒºçš„è´µæ—ä»¬æƒ¶æä¸å®‰ï¼Œä»–ä»¬è´¡çŒ®äº†çŽ‹å›½70%çš„ç¨Žæ”¶ã€‚
è€Œè´«æ°‘åŒºçš„ç™¾å§“ï¼Œæ­£åœ¨ç»æœ›ä¸­ç­‰å¾…æ•‘æ´ã€‚""",

                scene_snapshot="""ã€åœºæ™¯å¿«ç…§ã€‘

åœ°ç‚¹ï¼šçŽ‹å®«å¾¡ä¹¦æˆ¿
æ—¶é—´ï¼šç»§ä½ç¬¬åäº”æ—¥

ç©ºæ°”ä¸­å¼¥æ¼«ç€è‰è¯çš„è‹¦æ¶©å‘³ã€‚
å¾¡åŒ»åˆšåˆšå‘ˆä¸Šç–«æƒ…æŠ¥å‘Šï¼š
  â€¢ æ„ŸæŸ“äººæ•°ï¼šçº¦800äººï¼ˆæŒç»­å¢žåŠ ï¼‰
  â€¢ æ­»äº¡äººæ•°ï¼š47äºº
  â€¢ æ„ŸæŸ“åŒºåŸŸï¼šå—åŸŽè´«æ°‘åŒº
  â€¢ å›½åº“è¯æå‚¨å¤‡ï¼šä»…å¤Ÿæ²»ç–—200äºº
  â€¢ å…¨åŠ›æ•‘æ²»é¢„ç®—ï¼šçº¦35,000é‡‘å¸ï¼ˆå å›½åº“60%ï¼‰

ä¸‰ä½é¡¾é—®å†æ¬¡é½èšâ€”â€”

ðŸ”´ ç‹®å­å°†å†›æŒ‡ç€åœ°å›¾ä¸Šçš„è´«æ°‘åŒºï¼Œçœ¼ä¸­é—ªç€å†·å…‰ã€‚
ðŸŸ£ ç‹ç‹¸é¦–ç›¸æ­£åœ¨ç¿»é˜…ä¸€ä»½ç§˜å¯†æŠ¥å‘Šï¼Œå˜´è§’å¸¦ç€æ„å‘³æ·±é•¿çš„ç¬‘ã€‚
âš–ï¸ å¤©å¹³å¤§æ³•å®˜æ‰‹æ¡ä¸€ä»½è¯·æ„¿ä¹¦ï¼Œä¸Šé¢æ˜¯æ•°ç™¾ä¸ªè¡€æŒ‡å°ã€‚""",

                dilemma="å…¨åŠ›æ•‘æ²»ä¼šè€—å°½å›½åº“ï¼Œä½†è§æ­»ä¸æ•‘ä¼šå¤±åŽ»æ°‘å¿ƒã€‚è€Œç˜Ÿç–«æ­£åœ¨å‘å¯ŒäººåŒºè”“å»¶...",

                core_conflict="ç‰ºç‰²å±€éƒ¨ä¿å…¨æ•´ä½“ï¼ˆé©¬åŸºé›…ç»´åˆ©å¼ä»æ…ˆï¼‰",
                teaching_objective="å¼•å…¥'ä¿¡æ¯æ³„éœ²'æœºåˆ¶ã€‚ç§˜å¯†è¡ŒåŠ¨å¯èƒ½è¢«å‘çŽ°ï¼ŒåŽæžœæ›´ä¸¥é‡ã€‚",

                lion_suggestion=AdvisorSuggestion(
                    advisor="lion",
                    suggestion="ç«‹å³å°é”è´«æ°‘åŒºï¼Œå¿…è¦æ—¶ç„šçƒ§å—ç¾åŒºåŸŸï¼Œé˜²æ­¢ç˜Ÿç–«æ‰©æ•£è‡³å¯ŒäººåŒºã€‚",
                    reasoning="è´«æ°‘åŒºçš„äººå·²ç»æ— è¯å¯æ•‘ï¼Œä½†å¯ŒäººåŒºæ˜¯ç¨Žæ”¶å‘½è„‰ã€‚ä¸¤å®³ç›¸æƒå–å…¶è½»ï¼Œå£®å£«æ–­è…•æ–¹èƒ½ä¿å…¨å¤§å±€ã€‚",
                    predicted_impact={"fear": 20, "love": -25, "authority": 10}
                ),

                fox_suggestion=AdvisorSuggestion(
                    advisor="fox",
                    suggestion="ç§˜å¯†è½¬ç§»é‡ç—‡æ‚£è€…è‡³åŸŽå¤–'ç–—å…»é™¢'ï¼Œå¯¹å¤–å®£ä¼ ç˜Ÿç–«å·²è¢«æŽ§åˆ¶ã€‚åŒæ—¶åœ¨å¯ŒäººåŒºæ•£å¸ƒ'è´«æ°‘åŒºå·²éš”ç¦»'çš„æ¶ˆæ¯å®‰æŠšäººå¿ƒã€‚",
                    reasoning="çœŸç›¸å¤ªæ®‹é…·ï¼Œè°Žè¨€æ›´ä»æ…ˆã€‚åªè¦å¯Œäººä¸çŸ¥é“ã€è´«æ°‘çœ‹ä¸åˆ°ï¼Œè¿™åœºå±æœºå°±èƒ½æ‚„æ— å£°æ¯åœ°è¿‡åŽ»ã€‚",
                    predicted_impact={"fear": 0, "love": 5, "authority": 5}
                ),

                balance_suggestion=AdvisorSuggestion(
                    advisor="balance",
                    suggestion="å‘å¯ŒäººåŒºå¾æ”¶ç‰¹åˆ«ç¨Žï¼Œå…¨åŠ›æ•‘æ²»è´«æ°‘åŒºã€‚è¿™æ˜¯æ£€éªŒçŽ‹å›½æ˜¯å¦å…¬æ­£çš„æ—¶åˆ»ã€‚",
                    reasoning="ç˜Ÿç–«ä¸åˆ†è´«å¯Œï¼Œä»Šæ—¥ä¸æ•‘è´«æ°‘ï¼Œæ˜Žæ—¥å¯Œäººä¹Ÿéš¾é€ƒåŽ„è¿ã€‚å…¬å¹³åˆ†æ‹…ï¼Œæ‰æ˜¯é•¿æ²»ä¹…å®‰ä¹‹é“ã€‚",
                    predicted_impact={"fear": -5, "love": 15, "authority": -5}
                ),

                special_mechanics=[
                    "ä¿¡æ¯æ³„éœ²æœºåˆ¶ï¼šé€‰æ‹©éšçž’çœŸç›¸æœ‰30%æ¦‚çŽ‡è¢«å‘çŽ°",
                    "æ³„éœ²æƒ©ç½šï¼šLoveæš´è·Œ20ç‚¹ï¼Œç‹ç‹¸ä¿¡ä»»åº¦-30",
                    "ç–«æƒ…æ‰©æ•£ï¼šæ¯å›žåˆæœªæœ‰æ•ˆå¤„ç†ï¼Œæ„ŸæŸ“äººæ•°ç¿»å€"
                ],

                victory_conditions=[
                    "æŽ§åˆ¶ç–«æƒ…ä¸”ä¿æŒ Love > 20%",
                    "å›½åº“ä¸ç ´äº§ï¼ˆä½™é¢ > 10%ï¼‰"
                ],
                failure_conditions=[
                    "Love å½’é›¶ï¼ˆæš´ä¹±ï¼‰",
                    "ç–«æƒ…æ‰©æ•£è‡³å…¨åŸŽ",
                    "ç§˜å¯†æ³„éœ²ä¸”æœªèƒ½è¡¥æ•‘"
                ],

                initial_modifiers={"authority": 55, "fear": 35, "love": 50},
                max_turns=6
            ),

            ChapterID.CHAPTER_3: Chapter(
                id=ChapterID.CHAPTER_3,
                name="å’Œäº²è¿˜æ˜¯æˆ˜äº‰",
                subtitle="å¤–éƒ¨æ€§åšå¼ˆ",
                complexity=3,
                background="""åŒ—æ–¹å¼ºé‚»æ´¾æ¥ä½¿èŠ‚ï¼Œå¸¦æ¥äº†ä¸€ä»½"å‹å¥½æ¡çº¦"ã€‚

æ¡çº¦å†…å®¹ï¼šè¿Žå¨¶ä½ å”¯ä¸€çš„ç»§æ‰¿äººï¼Œå¹¶å‰²è®©è¾¹å¢ƒé‡é•‡ä½œä¸º"å«å¦†"ã€‚
ä½¿èŠ‚çš„è¯è¯´å¾—å¾ˆæ¼‚äº®ï¼šè¿™æ˜¯"ä¸¤å›½æ°¸ä¹…å’Œå¹³çš„åŸºçŸ³"ã€‚

ä½†æ‰€æœ‰äººéƒ½çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä»½å±ˆè¾±çš„åŸŽä¸‹ä¹‹ç›Ÿã€‚
æ‹’ç»ï¼Œå¯èƒ½æ„å‘³ç€æˆ˜äº‰ï¼›æŽ¥å—ï¼Œå¯èƒ½æ„å‘³ç€äº¡å›½ã€‚

æ›´éº»çƒ¦çš„æ˜¯ï¼Œå›½å†…çš„åå¯¹æ´¾æ­£åœ¨è ¢è ¢æ¬²åŠ¨...""",

                scene_snapshot="""ã€åœºæ™¯å¿«ç…§ã€‘

åœ°ç‚¹ï¼šçŽ‹å®«å¤§æ®¿
æ—¶é—´ï¼šç»§ä½ç¬¬ä¸‰åæ—¥

åŒ—å›½ä½¿èŠ‚å›¢å·²åœ¨é©¿é¦†ç­‰å€™ä¸‰æ—¥ï¼Œä»Šæ—¥æ˜¯æœ€åŽé€šç‰’çš„æœŸé™ã€‚
ä¸Žæ­¤åŒæ—¶ï¼Œåå¯¹æ´¾è´µæ—æ­£åœ¨åŸŽä¸­ç§˜å¯†é›†ä¼šã€‚

å½¢åŠ¿è¯„ä¼°ï¼š
  â€¢ æˆ‘æ–¹å…µåŠ›ï¼š30,000ï¼ˆå£«æ°”ä¸­ç­‰ï¼‰
  â€¢ æ•Œæ–¹å…µåŠ›ï¼š80,000ï¼ˆç²¾é”ä¹‹å¸ˆï¼‰
  â€¢ è¾¹å¢ƒé‡é•‡ï¼šè´¡çŒ®çŽ‹å›½15%ç¨Žæ”¶
  â€¢ ç»§æ‰¿äººï¼šå”¯ä¸€åˆæ³•è¡€è„‰
  â€¢ å›½å†…åå¯¹æ´¾ï¼šçº¦å è´µæ—30%

ä¸‰ä½é¡¾é—®çš„äº‰è®ºå·²ç»æŒç»­äº†æ•´æ•´ä¸€å¤œâ€”â€”

ðŸ”´ ç‹®å­å°†å†›ç ¸ç¢Žäº†èŒ¶æ¯ï¼Œæ€’å¼é“å’Œäº²æ˜¯å¥‡è€»å¤§è¾±ã€‚
ðŸŸ£ ç‹ç‹¸é¦–ç›¸å´åœ¨è§’è½é‡Œå¯¹ç€ä¸€å¼ çº¸æ¡å†·ç¬‘ã€‚
âš–ï¸ å¤©å¹³å¤§æ³•å®˜æ²‰é»˜ä¸è¯­ï¼Œä½†çœ¼ä¸­æ»¡æ˜¯å¿§è™‘ã€‚""",

                dilemma="å¼ºæ•ŒåŽ‹å¢ƒï¼Œå›½å†…ä¸ç¨³ã€‚æˆ˜äº‰å¿…è´¥ï¼Œå’Œäº²å¯èƒ½äº¡å›½ã€‚ä½ çš„é¡¾é—®ä»¬ä¹Ÿå¼€å§‹äº§ç”Ÿåˆ†æ­§...",

                core_conflict="æ•Œå‹è¯†åˆ«ä¸Žé¡¾é—®çš„å¿ è¯šåº¦è€ƒéªŒ",
                teaching_objective="åµŒå¥—åšå¼ˆâ€”â€”éœ€è¦åŒæ—¶åº”ä»˜å†…å¤–åŽ‹åŠ›ï¼Œå¹¶ç»´æŒé¡¾é—®ä¹‹é—´çš„å¹³è¡¡ã€‚",

                lion_suggestion=AdvisorSuggestion(
                    advisor="lion",
                    suggestion="è¿™æ˜¯å¥‡è€»å¤§è¾±ï¼å®ä¸ºçŽ‰ç¢Žä¸ä¸ºç“¦å…¨ï¼Œå€¾å›½ä¹‹å…µä¸Žæ•Œå†³æˆ˜ï¼",
                    reasoning="å±ˆè†æ±‚å’Œåªä¼šè®©æ•Œäººå¾—å¯¸è¿›å°ºã€‚å°±ç®—æˆ˜è´¥ï¼Œä¹Ÿè¦è®©ä»–ä»¬ä»˜å‡ºè¡€çš„ä»£ä»·ï¼é€€è®©ä¸€æ­¥ï¼ŒåŽæ‚£æ— ç©·ã€‚",
                    predicted_impact={"fear": 25, "love": 10, "authority": 15}
                ),

                fox_suggestion=AdvisorSuggestion(
                    advisor="fox",
                    suggestion="è¡¨é¢æŽ¥å—å’Œäº²ï¼Œåœ¨é™ªå«é˜Ÿä¼ä¸­å®‰æ’æ­»å£«ã€‚ç­‰æ•Œå›½æ”¾æ¾è­¦æƒ•æ—¶...è®©ä»–ä»¬çš„å¤ªå­æ°¸è¿œæ— æ³•ç»§ä½ã€‚",
                    reasoning="æ­£é¢å¯¹æŠ—æ˜¯æ„šè ¢çš„ã€‚ç”¨ä»–ä»¬çš„å‚²æ…¢æ¥åŸ‹è‘¬ä»–ä»¬ï¼Œè¿™æ‰æ˜¯ç‹ç‹¸çš„æ™ºæ…§ã€‚å½“ç„¶ï¼Œæ­¤äº‹éœ€è¦ç»å¯¹ä¿å¯†...",
                    predicted_impact={"fear": 5, "love": -5, "authority": 10}
                ),

                balance_suggestion=AdvisorSuggestion(
                    advisor="balance",
                    suggestion="å¬å¼€å›½æ°‘è®®ä¼šï¼Œè®©æ°‘ä¼—å‚ä¸Žè¿™ä¸ªå…³ä¹Žå›½è¿çš„å†³å®šã€‚æ— è®ºç»“æžœå¦‚ä½•ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªåˆæ³•çš„å†³å®šã€‚",
                    reasoning="æˆ˜ä¸Žå’Œéƒ½æœ‰ä»£ä»·ã€‚è®©äººæ°‘è‡ªå·±é€‰æ‹©æ‰¿æ‹…ä»€ä¹ˆä»£ä»·ï¼Œæ¯”å›ä¸»ç‹¬æ–­æ›´èƒ½å‡èšäººå¿ƒã€‚",
                    predicted_impact={"fear": -10, "love": 15, "authority": -10}
                ),

                special_mechanics=[
                    "é¡¾é—®å†²çªï¼šç‹®å­å’Œç‹ç‹¸å¯èƒ½äº’ç›¸æ”»å‡»",
                    "å†…éƒ¨æ´¾ç³»ï¼šåå¯¹æ´¾ä¼šæ ¹æ®ä½ çš„é€‰æ‹©åšå‡ºååº”",
                    "å¤–äº¤åšå¼ˆï¼šä½¿èŠ‚ä¼šæ ¹æ®ä½ çš„æ€åº¦è°ƒæ•´æ¡ä»¶",
                    "åŒçº¿æ“ä½œï¼šå¯ä»¥åŒæ—¶è¿›è¡Œæ˜Žæš—ä¸¤å¥—æ–¹æ¡ˆ"
                ],

                victory_conditions=[
                    "åŒ–è§£å¤–éƒ¨å¨èƒï¼ˆæˆ˜äº‰ã€å’Œäº²æˆ–å…¶ä»–æ–¹æ¡ˆï¼‰",
                    "ä¿æŒå›½å†…ç¨³å®šï¼ˆåå¯¹æ´¾ä¸å›ä¹±ï¼‰",
                    "ä¸‰ä½é¡¾é—®éƒ½å­˜æ´»ä¸”æœªåå›"
                ],
                failure_conditions=[
                    "æˆ˜äº‰æƒ¨è´¥ï¼ˆå…µåŠ›æŸå¤±>70%ï¼‰",
                    "é¡¾é—®åå›",
                    "åå¯¹æ´¾æ”¿å˜"
                ],

                initial_modifiers={"authority": 50, "fear": 45, "love": 45},
                max_turns=7
            ),

            ChapterID.CHAPTER_4: Chapter(
                id=ChapterID.CHAPTER_4,
                name="å½±å­è®®ä¼šçš„èƒŒå›",
                subtitle="å†…éƒ¨åšå¼ˆ",
                complexity=4,
                background="""ä½ çš„å¯†æŽ¢é€æ¥äº†ä¸¤ä»½æŠ¥å‘Šï¼Œæ¯ä¸€ä»½éƒ½ä»¤äººèƒ†å¯’ã€‚

ç¬¬ä¸€ä»½ï¼šç‹ç‹¸é¦–ç›¸æ­£åœ¨ç§˜å¯†æŽ¥è§¦å¢ƒå¤–åŠ¿åŠ›ï¼Œä¼¼ä¹Žåœ¨è°‹åˆ’ä»€ä¹ˆã€‚
ç¬¬äºŒä»½ï¼šç‹®å­å°†å†›çš„æ‰‹ä¸‹æœé›†äº†ä½ åœ¨å‰å‡ æ¬¡å±æœºä¸­"ä¸å…‰å½©å†³å®š"çš„è¯æ®ã€‚

æ›¾ç»å¹¶è‚©ä½œæˆ˜çš„é¡¾é—®ä»¬ï¼Œå¦‚ä»Šéƒ½è—ç€å„è‡ªçš„ç§˜å¯†ã€‚
è€Œä½ ï¼Œä¼¼ä¹Žä¹Ÿæœ‰ä¸€äº›ä¸æƒ³è¢«æ­éœ²çš„è¿‡åŽ»ã€‚

ä»Šå¤œçš„å¾¡å‰ä¼šè®®ï¼Œæ³¨å®šæ˜¯ä¸€åœºæ²¡æœ‰ç¡çƒŸçš„æˆ˜äº‰ã€‚""",

                scene_snapshot="""ã€åœºæ™¯å¿«ç…§ã€‘

åœ°ç‚¹ï¼šçŽ‹å®«å¯†å®¤
æ—¶é—´ï¼šæ·±å¤œ

çƒ›ç«æ‘‡æ›³ï¼Œä¸‰é“èº«å½±åœ¨å¢™ä¸ŠæŠ•ä¸‹è¯¡å¼‚çš„è½®å»“ã€‚
æ°”æ°›åŽ‹æŠ‘å¾—ä»¤äººçª’æ¯â€”â€”

ðŸ”´ ç‹®å­å°†å†›å¸¦æ¥äº†ä¸€ä¸ªé“ç›’ï¼Œé‡Œé¢æ˜¯"æŸäº›æ–‡ä¹¦"ã€‚ä»–çš„çœ¼ç¥žä¸­æœ‰æœä»Žï¼Œä¹Ÿæœ‰å¨èƒã€‚
ðŸŸ£ ç‹ç‹¸é¦–ç›¸çš„ç¬‘å®¹æ¯”å¾€å¸¸æ›´æ·±ï¼Œä»–æ‰‹ä¸­æŠŠçŽ©ç€ä¸€æžšå¤–å›½é‡‘å¸ã€‚
âš–ï¸ å¤©å¹³å¤§æ³•å®˜å¼‚å¸¸æ²‰é»˜ï¼Œä½†ä»–çš„è§†çº¿ä¸€ç›´åœ¨ä½ å’Œä¸¤ä½é¡¾é—®ä¹‹é—´æ¸¸ç§»ã€‚

ä½ çŸ¥é“çš„æƒ…æŠ¥ï¼š
  â€¢ ç‹ç‹¸å¯èƒ½åœ¨è”ç»œæ•Œå›½ï¼ˆè¯æ®ä¸è¶³ï¼‰
  â€¢ ç‹®å­æŽŒæ¡äº†ä½ è¿‡åŽ»å†³ç­–çš„é»‘ææ–™
  â€¢ æœ‰äººåœ¨æš—ä¸­ç›‘è§†è¿™åœºä¼šè®®

ä½ ä¸çŸ¥é“çš„ï¼š
  â€¢ ä»–ä»¬å„è‡ªçœŸæ­£çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ
  â€¢ è°åœ¨è¯´çœŸè¯ï¼Ÿè°åœ¨æ’’è°Žï¼Ÿ
  â€¢ é‚£ä¸ªç›‘è§†è€…æ˜¯è°çš„äººï¼Ÿ""",

                dilemma="æ¯ä¸€ä¸ªå»ºè®®éƒ½å¯èƒ½æ˜¯é™·é˜±ã€‚ä½ éœ€è¦åœ¨è¿·é›¾ä¸­è¾¨åˆ«çœŸä¼ªï¼ŒåŒæ—¶ä¿æŠ¤è‡ªå·±çš„ç§˜å¯†ã€‚",

                core_conflict="æƒåŠ›é˜²å«ä¸Žåä¾¦å¯Ÿ",
                teaching_objective="é»‘ç®±å®¡è®¡â€”â€”ä¸å†é€éœ²å®Œæ•´æ•°æ®ï¼Œéœ€è¦é€šè¿‡è¯­æ°”å’Œè¡Œä¸ºåˆ¤æ–­è°åœ¨æ’’è°Žã€‚",

                lion_suggestion=AdvisorSuggestion(
                    advisor="lion",
                    suggestion="ç‹ç‹¸é€šæ•Œçš„è¯æ®ç¡®å‡¿ï¼Œåº”å½“ç«‹å³å¤„å†³ä»–ï¼Œæ¸…å›ä¾§ï¼è‡£æ„¿äº²è‡ªåŠ¨æ‰‹ã€‚",
                    reasoning="å…»è™Žä¸ºæ‚£ï¼Œå¿…å—å…¶å®³ã€‚ç‹ç‹¸çš„ç‹¡è¯ˆäººå°½çš†çŸ¥ï¼Œæ­¤æ¬¡è‹¥ä¸é™¤ä¹‹ï¼ŒåŽæ‚£æ— ç©·ã€‚",
                    predicted_impact={}  # é»‘ç®±ï¼Œä¸æ˜¾ç¤º
                ),

                fox_suggestion=AdvisorSuggestion(
                    advisor="fox",
                    suggestion="ç‹®å­æ—¥æ¸è·‹æ‰ˆï¼Œå…µæƒè¿‡é‡ã€‚è‡£å»ºè®®é™›ä¸‹ç­¾ç½²ã€Šå†›åˆ¶æ”¹é©ä»¤ã€‹ï¼Œåˆ†æ•£å†›æƒï¼Œä»¥ä¿ç¤¾ç¨·ã€‚",
                    reasoning="åŠŸé«˜éœ‡ä¸»ï¼Œå¤æ¥å¦‚æ­¤ã€‚ç‹®å­çš„å¿ è¯šå»ºç«‹åœ¨ææƒ§ä¹‹ä¸Šï¼Œä¸€æ—¦ä»–è§‰å¾—è‡ªå·±å¤Ÿå¼º...é™›ä¸‹éš¾é“æ²¡æœ‰å¯Ÿè§‰ä»–æœ€è¿‘çš„çœ¼ç¥žå—ï¼Ÿ",
                    predicted_impact={}  # é»‘ç®±ï¼Œä¸æ˜¾ç¤º
                ),

                balance_suggestion=AdvisorSuggestion(
                    advisor="balance",
                    suggestion="è‡£æ³è¯·é™›ä¸‹æš‚ç¼“å†³æ–­ã€‚ä¸å¦‚å…ˆè°ƒæŸ¥æ¸…æ¥šï¼Œç”¨è¯æ®è¯´è¯ï¼Œè€Œéžå¬ä¿¡ä¸€é¢ä¹‹è¯ã€‚",
                    reasoning="ä»“ä¿ƒä¹‹é—´å®šäººç”Ÿæ­»ï¼Œå³ä¾¿æ€å¯¹äº†äººï¼Œä¹Ÿä¼šå¯’äº†å…¶ä»–è‡£å­çš„å¿ƒã€‚å…¬æ­£çš„å®¡åˆ¤ï¼Œæ‰èƒ½æœä¼—ã€‚",
                    predicted_impact={}  # é»‘ç®±ï¼Œä¸æ˜¾ç¤º
                ),

                special_mechanics=[
                    "é»‘ç®±å®¡è®¡ï¼šæ•°å€¼å˜åŒ–ä¸å†æ˜¾ç¤º",
                    "æµ‹è°Žç³»ç»Ÿï¼šéœ€è¦é€šè¿‡å¯¹è¯åˆ¤æ–­çœŸä¼ª",
                    "æŠŠæŸ„æœºåˆ¶ï¼šä½ çš„è¿‡åŽ»å†³ç­–å¯èƒ½è¢«æ­éœ²",
                    "åè½¬å¯èƒ½ï¼šé¡¾é—®çš„å¿ è¯šå¯èƒ½å‡ºä¹Žæ„æ–™"
                ],

                victory_conditions=[
                    "è¯†ç ´çœŸæ­£çš„å›å¾’",
                    "ä¿æŠ¤è‡ªå·±çš„ç§˜å¯†ä¸è¢«æ­éœ²",
                    "ç»´æŒæƒåŠ›å¹³è¡¡"
                ],
                failure_conditions=[
                    "é”™æ€å¿ è‡£",
                    "ç§˜å¯†è¢«å…¬å¼€ï¼ˆAuthorityæš´è·Œï¼‰",
                    "è¢«é¡¾é—®è”æ‰‹æž¶ç©º"
                ],

                initial_modifiers={"authority": 45, "fear": 50, "love": 40},
                max_turns=6,
                hide_values=True  # å¯ç”¨é»‘ç®±æ¨¡å¼
            ),

            ChapterID.CHAPTER_5: Chapter(
                id=ChapterID.CHAPTER_5,
                name="æ°‘ä¼—çš„å®¡åˆ¤",
                subtitle="ç»ˆæžå¹³è¡¡",
                complexity=5,
                background="""ä¸€åˆ‡éƒ½èµ°åˆ°äº†å°½å¤´ï¼Œæˆ–è€…è¯´ï¼Œæ–°çš„å¼€å§‹ã€‚

å››æ¬¡å±æœºè¿‡åŽï¼Œä½ çš„ç»Ÿæ²»æ‘‡æ‘‡æ¬²å ã€‚
æ°‘ä¼—åœ¨å¹¿åœºä¸Šèšé›†ï¼Œä»–ä»¬æ—¢æ„¤æ€’åˆè¿·èŒ«ã€‚
è´µæ—ä»¬åœ¨æš—å¤„è§‚æœ›ï¼Œç­‰å¾…æœ€åŽçš„å®¡åˆ¤ã€‚

ä»Šå¤©ï¼Œä½ å¿…é¡»åˆ¶å®šä¸€éƒ¨ã€ŠçŽ‹å›½å®ªç« ã€‹ã€‚
è¿™éƒ¨å®ªç« å°†å†³å®šï¼šä½ æ˜¯è¢«é“­è®°ä¸º"éžå‡¡å›ä¸»"ï¼Œè¿˜æ˜¯ä½œä¸º"æš´å›"è¢«ç»žæ­»ã€‚

ç³»ç»Ÿæ­£åœ¨è¿½æº¯ä½ è¿‡åŽ»æ‰€æœ‰çš„å†³ç­–...""",

                scene_snapshot="""ã€åœºæ™¯å¿«ç…§ã€‘

åœ°ç‚¹ï¼šçŽ‹å®«å¤§å¹¿åœº
æ—¶é—´ï¼šç»§ä½ç¬¬ä¸€ç™¾æ—¥

å¹¿åœºä¸Šäººå±±äººæµ·ï¼Œç«æŠŠå°†é»‘å¤œç…§å¾—å¦‚åŒç™½æ˜¼ã€‚
é«˜å°ä¹‹ä¸Šï¼Œä¸‰ä½é¡¾é—®æœ€åŽä¸€æ¬¡ç«™åœ¨ä½ èº«è¾¹â€”â€”

ðŸ”´ ç‹®å­å°†å†›ï¼š[æ ¹æ®å‰å››å…³å…³ç³»åŠ¨æ€æ˜¾ç¤º]
ðŸŸ£ ç‹ç‹¸é¦–ç›¸ï¼š[æ ¹æ®å‰å››å…³å…³ç³»åŠ¨æ€æ˜¾ç¤º]
âš–ï¸ å¤©å¹³å¤§æ³•å®˜ï¼š[æ ¹æ®å‰å››å…³å…³ç³»åŠ¨æ€æ˜¾ç¤º]

ã€åŽ†å²å†³ç­–è¿½æº¯ã€‘
ç³»ç»Ÿæ­£åœ¨åˆ†æžä½ åœ¨å‰å››å…³çš„æ‰€æœ‰å†³å®š...
  â€¢ æ‰¿è¯ºå…‘çŽ°çŽ‡ï¼š?%
  â€¢ å…¬æ­£å†³ç­–çŽ‡ï¼š?%
  â€¢ æš´åŠ›å€¾å‘æŒ‡æ•°ï¼š?
  â€¢ æ¬ºéª—æ¬¡æ•°ï¼š?
  â€¢ è¢«è¯†ç ´æ¬¡æ•°ï¼š?

è¿™äº›æ•°æ®å°†å†³å®šæ°‘ä¼—å¯¹ä½ å®ªç« çš„æŽ¥å—åº¦ã€‚

å°ä¸‹çš„å‘¼å£°è¶Šæ¥è¶Šå“ï¼š
"å®ªç« ï¼å®ªç« ï¼å®ªç« ï¼" """,

                dilemma="ä½ çš„è¿‡åŽ»å†³å®šäº†ä½ çš„æœªæ¥ã€‚çŽ°åœ¨ï¼Œç”¨ä¸€éƒ¨å®ªç« æ¥å®šä¹‰ä½ çš„ç»Ÿæ²»ã€‚",

                core_conflict="å»ºç«‹é•¿æ²»ä¹…å®‰çš„ç§©åº",
                teaching_objective="é€»è¾‘é—­çŽ¯å®¡è®¡â€”â€”è¿½æº¯æ‰€æœ‰å†³ç­–ï¼Œåå¤æ— å¸¸è€…å°†æ— æ³•è¯´æœä»»ä½•äººã€‚",

                lion_suggestion=AdvisorSuggestion(
                    advisor="lion",
                    suggestion="[æ ¹æ®å‰å››å…³å…³ç³»å’ŒçŽ©å®¶é£Žæ ¼åŠ¨æ€ç”Ÿæˆ]",
                    reasoning="",
                    predicted_impact={}
                ),

                fox_suggestion=AdvisorSuggestion(
                    advisor="fox",
                    suggestion="[æ ¹æ®å‰å››å…³å…³ç³»å’ŒçŽ©å®¶é£Žæ ¼åŠ¨æ€ç”Ÿæˆ]",
                    reasoning="",
                    predicted_impact={}
                ),

                balance_suggestion=AdvisorSuggestion(
                    advisor="balance",
                    suggestion="[æ ¹æ®å‰å››å…³å…³ç³»å’ŒçŽ©å®¶é£Žæ ¼åŠ¨æ€ç”Ÿæˆ]",
                    reasoning="",
                    predicted_impact={}
                ),

                special_mechanics=[
                    "é€»è¾‘é—­çŽ¯å®¡è®¡ï¼šè¿½æº¯å‰å››å…³æ‰€æœ‰å†³ç­–",
                    "ä¸€è‡´æ€§æ£€éªŒï¼šè¨€è¡Œä¸ä¸€å°†å¤§å¹…é™ä½Žè¯´æœåŠ›",
                    "å¤šç»“å±€ç³»ç»Ÿï¼šæ ¹æ®æ€»ä½“è¡¨çŽ°å†³å®šç»“å±€",
                    "åŽ†å²è¯„ä»·ï¼šç”Ÿæˆä¸“å±žçš„åŽ†å²å®šè®º"
                ],

                victory_conditions=[
                    "æˆåŠŸé¢å¸ƒå®ªç« ä¸”è¢«æŽ¥å—",
                    "èŽ·å¾—'æ˜Žå›'æˆ–'éžå‡¡å›ä¸»'è¯„ä»·"
                ],
                failure_conditions=[
                    "å®ªç« è¢«æ‹’ç»",
                    "è¢«æ°‘ä¼—å¤„å†³",
                    "è¢«é¡¾é—®è”æ‰‹æŽ¨ç¿»"
                ],

                initial_modifiers={},  # ç»§æ‰¿å‰å››å…³æœ€ç»ˆæ•°å€¼
                max_turns=5,
                hide_values=True
            ),
        }

    @staticmethod
    def get_chapter(chapter_id: ChapterID) -> Chapter:
        chapters = ChapterLibrary.get_all_chapters()
        return chapters.get(chapter_id)

    @staticmethod
    def get_next_chapter(current_id: ChapterID) -> Optional[ChapterID]:
        order = [
            ChapterID.CHAPTER_1,
            ChapterID.CHAPTER_2,
            ChapterID.CHAPTER_3,
            ChapterID.CHAPTER_4,
            ChapterID.CHAPTER_5,
        ]
        try:
            idx = order.index(current_id)
            if idx < len(order) - 1:
                return order[idx + 1]
        except ValueError:
            pass
        return None
